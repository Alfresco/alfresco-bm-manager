<html>

<head>
    <meta charset="UTF-8">
    <meta content="utf-8" http-equiv="encoding">
</head>
<style>
body {
    width: 1200px;
    margin: auto;
    position: relative;
}
svg {
    font: 11px"Helvetica Neue", Helvetica, Arial, sans-serif;
}
.axis path {
    fill: none;
    stroke: #000;
    shape-rendering: crispEdges;
}
.axis line{
    fill: none;
    stroke: #ccc;
    shape-rendering: crispEdges;
}
.axis--y path {
    display: none;
}
.events {
    fill: none;
    stroke: #aaa;
    stroke-linejoin: round;
    stroke-linecap: round;
    stroke-width: 1.5px;
}
.event--hover {
    stroke: #000;
}
.focus_point text {
    text-anchor: middle;
    text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
}

#form {
    position: absolute;
    top: 20px;
    right: 30px;
}

.brush .extent {
    stroke: #fff;
    fill-opacity: .125;
    shape-rendering: crispEdges;
}
.legend {
  fill: #fff;
  stroke: #000;
  /*stroke-dasharray: 3, 4;*/
}

</style>
<script src="http://d3js.org/d3.v3.min.js"></script>

<body>
    <section id="graph">
        <section id="historic"></section>
    </section>
    <script>
  var data = 
[{"time":"Jan 2000","value":"1394.46","name":"search"},
{"time":"Feb 2000","value":"1366.42","name":"search"},
{"time":"Mar 2000","value":"1498.58","name":"search"},
{"time":"Apr 2000","value":"1452.43","name":"search"},
{"time":"May 2000","value":"1420.6","name":"search"},
{"time":"Jun 2000","value":"1454.6","name":"search"},
{"time":"Jul 2000","value":"1430.83","name":"search"},
{"time":"Aug 2000","value":"1517.68","name":"search"},
{"time":"Sep 2000","value":"1436.51","name":"search"},
{"time":"Oct 2000","value":"1429.4","name":"search"},
{"time":"Nov 2000","value":"1314.95","name":"search"},
{"time":"Dec 2000","value":"1320.28","name":"search"},
{"time":"Jan 2001","value":"1366.01","name":"search"},
{"time":"Feb 2001","value":"1239.94","name":"search"},
{"time":"Mar 2001","value":"1160.33","name":"search"},
{"time":"Apr 2001","value":"1249.46","name":"search"},
{"time":"May 2001","value":"1255.82","name":"search"},
{"time":"Jun 2001","value":"1224.38","name":"search"},
{"time":"Jul 2001","value":"1211.23","name":"search"},
{"time":"Aug 2001","value":"1133.58","name":"search"},
{"time":"Sep 2001","value":"1040.94","name":"search"},
{"time":"Oct 2001","value":"1059.78","name":"search"},
{"time":"Nov 2001","value":"1139.45","name":"search"},
{"time":"Dec 2001","value":"1148.08","name":"search"},
{"time":"Jan 2002","value":"1130.2","name":"search"},
{"time":"Feb 2002","value":"1106.73","name":"search"},
{"time":"Mar 2002","value":"1147.39","name":"search"},
{"time":"Apr 2002","value":"1076.92","name":"search"},
{"time":"May 2002","value":"1067.14","name":"search"},
{"time":"Jun 2002","value":"989.82","name":"search"},
{"time":"Jul 2002","value":"911.62","name":"search"},
{"time":"Aug 2002","value":"916.07","name":"search"},
{"time":"Sep 2002","value":"815.28","name":"search"},
{"time":"Oct 2002","value":"885.76","name":"search"},
{"time":"Nov 2002","value":"936.31","name":"search"},
{"time":"Dec 2002","value":"879.82","name":"search"},
{"time":"Jan 2003","value":"855.7","name":"search"},
{"time":"Feb 2003","value":"841.15","name":"search"},
{"time":"Mar 2003","value":"848.18","name":"search"},
{"time":"Apr 2003","value":"916.92","name":"search"},
{"time":"May 2003","value":"963.59","name":"search"},
{"time":"Jun 2003","value":"974.5","name":"search"},
{"time":"Jul 2003","value":"990.31","name":"search"},
{"time":"Aug 2003","value":"1008.01","name":"search"},
{"time":"Sep 2003","value":"995.97","name":"search"},
{"time":"Oct 2003","value":"1050.71","name":"search"},
{"time":"Nov 2003","value":"1058.2","name":"search"},
{"time":"Dec 2003","value":"1111.92","name":"search"},
{"time":"Jan 2004","value":"1131.13","name":"search"},
{"time":"Feb 2004","value":"1144.94","name":"search"},
{"time":"Mar 2004","value":"1126.21","name":"search"},
{"time":"Apr 2004","value":"1107.3","name":"search"},
{"time":"May 2004","value":"1120.68","name":"search"},
{"time":"Jun 2004","value":"1140.84","name":"search"},
{"time":"Jul 2004","value":"1101.72","name":"search"},
{"time":"Aug 2004","value":"1104.24","name":"search"},
{"time":"Sep 2004","value":"1114.58","name":"search"},
{"time":"Oct 2004","value":"1130.2","name":"search"},
{"time":"Nov 2004","value":"1173.82","name":"search"},
{"time":"Dec 2004","value":"1211.92","name":"search"},
{"time":"Jan 2005","value":"1181.27","name":"search"},
{"time":"Feb 2005","value":"1203.6","name":"search"},
{"time":"Mar 2005","value":"1180.59","name":"search"},
{"time":"Apr 2005","value":"1156.85","name":"search"},
{"time":"May 2005","value":"1191.5","name":"search"},
{"time":"Jun 2005","value":"1191.33","name":"search"},
{"time":"Jul 2005","value":"1234.18","name":"search"},
{"time":"Aug 2005","value":"1220.33","name":"search"},
{"time":"Sep 2005","value":"1228.81","name":"search"},
{"time":"Oct 2005","value":"1207.01","name":"search"},
{"time":"Nov 2005","value":"1249.48","name":"search"},
{"time":"Dec 2005","value":"1248.29","name":"search"},
{"time":"Jan 2006","value":"1280.08","name":"search"},
{"time":"Feb 2006","value":"1280.66","name":"search"},
{"time":"Mar 2006","value":"1294.87","name":"search"},
{"time":"Apr 2006","value":"1310.61","name":"search"},
{"time":"May 2006","value":"1270.09","name":"search"},
{"time":"Jun 2006","value":"1270.2","name":"search"},
{"time":"Jul 2006","value":"1276.66","name":"search"},
{"time":"Aug 2006","value":"1303.82","name":"search"},
{"time":"Sep 2006","value":"1335.85","name":"search"},
{"time":"Oct 2006","value":"1377.94","name":"search"},
{"time":"Nov 2006","value":"1400.63","name":"search"},
{"time":"Dec 2006","value":"1418.3","name":"search"},
{"time":"Jan 2007","value":"1438.24","name":"search"},
{"time":"Feb 2007","value":"1406.82","name":"search"},
{"time":"Mar 2007","value":"1420.86","name":"search"},
{"time":"Apr 2007","value":"1482.37","name":"search"},
{"time":"May 2007","value":"1530.62","name":"search"},
{"time":"Jun 2007","value":"1503.35","name":"search"},
{"time":"Jul 2007","value":"1455.27","name":"search"},
{"time":"Aug 2007","value":"1473.99","name":"search"},
{"time":"Sep 2007","value":"1526.75","name":"search"},
{"time":"Oct 2007","value":"1549.38","name":"search"},
{"time":"Nov 2007","value":"1481.14","name":"search"},
{"time":"Dec 2007","value":"1468.36","name":"search"},
{"time":"Jan 2008","value":"1378.55","name":"search"},
{"time":"Feb 2008","value":"1330.63","name":"search"},
{"time":"Mar 2008","value":"1322.7","name":"search"},
{"time":"Apr 2008","value":"1385.59","name":"search"},
{"time":"May 2008","value":"1400.38","name":"search"},
{"time":"Jun 2008","value":"1280","name":"navigate"},
{"time":"Jul 2008","value":"1267.38","name":"navigate"},
{"time":"Aug 2008","value":"1282.83","name":"navigate"},
{"time":"Sep 2008","value":"1166.36","name":"navigate"},
{"time":"Oct 2008","value":"968.75","name":"navigate"},
{"time":"Nov 2008","value":"896.24","name":"navigate"},
{"time":"Dec 2008","value":"903.25","name":"navigate"},
{"time":"Jan 2009","value":"825.88","name":"navigate"},
{"time":"Feb 2009","value":"735.09","name":"navigate"},
{"time":"Mar 2009","value":"797.87","name":"navigate"},
{"time":"Apr 2009","value":"872.81","name":"navigate"},
{"time":"May 2009","value":"919.14","name":"navigate"},
{"time":"Jun 2009","value":"919.32","name":"navigate"},
{"time":"Jul 2009","value":"987.48","name":"navigate"},
{"time":"Aug 2009","value":"1020.62","name":"navigate"},
{"time":"Sep 2009","value":"1057.08","name":"navigate"},
{"time":"Oct 2009","value":"1036.19","name":"navigate"},
{"time":"Nov 2009","value":"1095.63","name":"search"},
{"time":"Dec 2009","value":"1115.1","name":"search"},
{"time":"Jan 2010","value":"1073.87","name":"search"},
{"time":"Feb 2010","value":"1104.49","name":"search"},
{"time":"Mar 2010","value":"1140.45","name":"search"}];

    var colors = new Array();
        colors = d3.scale.category20();
    var margin = {
        top: 20,
        right: 80,
        bottom: 110,
        left: 40
    },
    mini_margin = {
            top: 430,
            right: 80,
            bottom: 40,
            left: 10
        },

        width = 960 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom,
        mini_height = 500 - mini_margin.top - mini_margin.bottom;
    legend_margin = {
            top: 500,
            right: 80,
            bottom: 40,
            left: 10
        },
        legend_height = 50;
    // var parseDate = d3.time.format("%Y-%m-%d %H:%M:%S").parse;
    // var parseDate = d3.time.format("%Y-%m-%d").parse;
    var parseDate = d3.time.format("%b %Y").parse;
    // Using time range instead of scale to display date and time on axis.
    var x = d3.time.scale().range([0, width]),
        mini_x = d3.time.scale().range([0, width]),
        xAxis2 = d3.svg.axis().scale(mini_x).orient("bottom"),
        y = d3.scale.linear().range([height, 0]),
        mini_y = d3.scale.linear().range([mini_height, 0])
        color = d3.scale.category10(),
        line = d3.svg.line()
            .interpolate("linear")
            .x(function(d) {
                return x(d.time);
            })
            .y(function(d) {
                return y(d.value);
            }),
        brush = d3.svg.brush()
            .x(mini_x)
            .on("brush", brushed);
    //Prepare data
    data = data.map(function(d) {
        d.time = parseDate(d.time);
        d.value = +d.value;
        return d;
    });
    //nest data by event
    data = d3.nest().key(function(d) {
        return d.name;
    }).entries(data);

    //rename key property to name
    data = data.map(function(z) {
        if (z.hasOwnProperty("key")) {
            z.name = z.key;
            delete z.key;
        }
        return z;
    })

    var data = data.map(function(d) {
        var event = {
            name: d.name,
            values: null
        };
        event.values = d.values.map(function(f) {
            return {
                "event": event,
                "time": f.time,
                "value": f.value
            };
        });
        return event;
    });
    // prepare data end 

    var xAxis = d3.svg.axis()
        .scale(x)
        .tickSize(-height)
        .tickPadding(10)    
        .tickSubdivide(true)    
        .orient("bottom");  
    
    var yAxis = d3.svg.axis()
        .scale(y)
        .tickPadding(10)
        .tickSize(-width)
        .tickSubdivide(true)    
        .orient("left");
    
    x.domain([d3.min(data, function(d) {
            return d3.min(d.values, function(d) {
                return d.time;
            });
        }),
        d3.max(data, function(d) {
            return d3.max(d.values, function(d) {
                return d.time;
            });
        })
    ]);

    y.domain([0, d3.max(data, function(d) {
        return d3.max(d.values, function(d) {
            return d.value;
        });
    })]);

    //Angularjs replace html tag
    // var el = element[0];
    // var svg = d3.select(el).append("svg")
    var svg = d3.select("body").append("svg");
    //Main chart view
    var chart = svg.append("g")
        .attr("class", "chart")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height -100 + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    //X axis
    chart.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")") //adds the x grids
        .call(xAxis);
    //Y axis
    chart.append("g")
        .attr("class", "y axis")
        .call(yAxis);
    //focus of chart view 
    var focus = chart.append("g")
        .attr("class", "focus")
    //Evnet line chart
    focus.append("g")
        .selectAll("path")
        .data(data)
        .enter().append("path")
        .attr("class","events")
        .attr("d", function(ci) {
            ci.line = this;
            var res = line(ci.values);
            return res
        })
        .style("stroke", function(d) { return colors(d.name); });
    //Attach to drawing window.
    focus.attr("clip-path", "url(#clip)");

    //------------- start brush slider
    var line2 = d3.svg.line()
        .x(function(d) {
            return mini_x(d.time);
        })
        .y(function(d) {
            return mini_y(d.value);
        })
        .interpolate('basis');

    var brush = d3.svg.brush() //for slider bar at the bottom
                    .x(mini_x)
                    .on("brush", brushed);
    //brush zoom view.
    chart.append("defs").append("clipPath")
        .attr("id", "clip")
        .attr("width", 500)
        .attr("x",-100)
        .append("rect")
        .attr("width", width+1)
        .attr("height", height);
    
    //Zoom brush domains
    mini_x.domain(x.domain());
    mini_y.domain(y.domain());
    //Start events legend
    var legend = svg.append("g")
        .attr("class","legend")
        .attr("transform", "translate(40," + legend_margin.top + ")");
            //Brushed view x axis 
    legend.append("g").append("rect")
    .attr("class", "legend")
    .attr("width", width)
    .attr("height", legend_height);
    //end events legend

    var slider = svg.append("g")
        .attr("class", "slider")
        .attr("transform", "translate(40," + mini_margin.top + ")");
    
    //Event line plotter for the brush view
    slider.append("g")
        .attr("class", "events")
        .selectAll("path")
        .data(data)
        .enter().append("path")
        .attr("d", function(minidata) {
            minidata.line = this;
            var res = line2(minidata.values);
            return res
        });
    //Brushed view x axis 
    slider.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + mini_height + ")")
        .call(xAxis2);
    //Brushed view y axis 
    slider.append("g")
        .attr("class", "x brush")
        .call(brush)
        .selectAll("rect")
        .attr("y", -6)
        .attr("height", mini_height + 7);

    function brushed() {
        x.domain(brush.empty() ? mini_x.domain() : brush.extent());
        focus.selectAll('.events').attr('d', function(d) { return line(d.values); });
        focus.select(".x.axis").call(xAxis);
    }

    </script>
</body>

</html>
